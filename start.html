<!DOCTYPE html>
<html>
  <head>
    <title>Start Writing — Authored</title>
    <meta charset="UTF-8" />
  </head>

  <body style="font-family: Arial, sans-serif; margin: 60px; max-width: 700px;">
    <h1>Start your book</h1>

    <p>You don’t need a finished idea to begin. Just answer a few questions.</p>

    <p>
      <label><strong>What do you want to write about?</strong></label><br />
      <textarea id="topic" rows="4" style="width:100%;" placeholder="It’s okay if you’re not sure yet."></textarea>
    </p>

    <p>
      <label><strong>Who is this for?</strong></label><br />
      <input id="audience" type="text" style="width:100%;" placeholder="Who do you want to reach?" />
    </p>

    <p>
      <label><strong>What’s been stopping you from writing?</strong></label><br />
      <input id="blocker" type="text" style="width:100%;" placeholder="Fear, time, clarity, confidence…" />
    </p>

    <p>
      <button id="beginBtn" type="button">Begin</button>
      &nbsp; <a href="/index.html">Back to home</a>
    </p>

    <hr />

    <div id="result" style="display:none;">
      <h2>Your starting point</h2>

      <p><strong>Working title:</strong> <span id="titleOut"></span></p>

      <p><strong>One-sentence purpose:</strong></p>
      <p id="purposeOut"></p>

      <p><strong>Starter outline (5 chapters):</strong></p>
      <ol id="outlineOut"></ol>
    </div>

   <script>
  function clean(text) {
    return (text || "").toString().trim();
  }

  document.getElementById("beginBtn").addEventListener("click", async function () {
    const topic = clean(document.getElementById("topic").value);
    const audience = clean(document.getElementById("audience").value);
    const blocker = clean(document.getElementById("blocker").value);

    // Show loading state
    document.getElementById("result").style.display = "block";
    document.getElementById("titleOut").textContent = "Generating...";
    document.getElementById("purposeOut").textContent = "Please wait...";
    document.getElementById("outlineOut").innerHTML = "<li>Creating your outline...</li>";

    try {
      const response = await fetch("/api/outline", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic, audience, blocker }),
      });

      const data = await response.json();

      if (!response.ok) throw new Error(data.error || "Request failed");

      document.getElementById("titleOut").textContent = data.title || "Untitled";
      document.getElementById("purposeOut").textContent = data.purpose || "";

      const list = document.getElementById("outlineOut");
      list.innerHTML = "";
      (data.outline || []).forEach((item) => {
        const li = document.createElement("li");
        li.textContent = item;
        list.appendChild(li);
      });

      document.getElementById("result").scrollIntoView({ behavior: "smooth" });
    } catch (err) {
      document.getElementById("titleOut").textContent = "Could not generate outline";
      document.getElementById("purposeOut").textContent = "Something went wrong. Please try again.";
      document.getElementById("outlineOut").innerHTML = "<li>Error generating outline.</li>";
    }
  });
</script>
