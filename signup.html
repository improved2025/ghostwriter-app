<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign up</title>
</head>
<body style="font-family:Arial; max-width:420px; margin:60px auto;">
  <h2>Create your account</h2>
  <p style="color:#666;">Email + password. No confirmation email required.</p>

  <label>Email</label><br/>
  <input id="email" type="email" style="width:100%; padding:10px; margin:6px 0 12px;" />

  <label>Password</label><br/>
  <input id="password" type="password" style="width:100%; padding:10px; margin:6px 0 12px;" />

  <button id="btn" style="padding:10px 14px;">Sign up</button>
  <p id="msg" style="margin-top:12px;"></p>

  <p style="margin-top:14px;">
    Already have an account? <a href="login.html">Log in</a>
  </p>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="account.js"></script>
  <script>
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    function getReturnTo() {
      const p = new URLSearchParams(location.search);
      return p.get("returnTo") || "start.html";
    }

    btn.addEventListener("click", async () => {
      msg.textContent = "Creating account...";
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      const { data, error } = await window.AuthoredAccount.signUp(email, password);
      if (error) { msg.textContent = error.message; return; }

      // Make sure user usage row exists (weâ€™ll create the table next)
      const user = data.user;
      if (user) {
        try { await window.AuthoredAccount.ensureUsageRow(user.id); } catch {}
      }

      msg.textContent = "Account created. Redirecting...";
      location.href = getReturnTo();
    });
  </script>
</body>
</html>
